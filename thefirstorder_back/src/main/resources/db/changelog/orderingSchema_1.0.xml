<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="1" author="xinyi">
		<createTable tableName="customer"
                     remarks="A table to contain all customer details">
            <column name="customer_id" type="varchar(10)">
				<constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="first_name" type="varchar(45)">
                <constraints nullable="false" />
            </column>
			<column name="last_name" type="varchar(45)">
                <constraints nullable="false" />
            </column>
			<column name="password" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
			<column name="gender" type="char(1)">
				<constraints nullable="false"/>
            </column>
			<column name="dob" type="date">
                <constraints nullable="false"/>
            </column>
            <column name="phone_num" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
			<column name="loyalty_point" type="int(10)">
                <constraints nullable="false"/>
            </column>
        </createTable>
									
		<createTable tableName="credit_card"
                     remarks="A table to contain all credit card details">
			<column name="card_number" type="varchar(16)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
			<column name="customer_id" type="varchar(10)">
				<constraints nullable="false" />
            </column>
            <column name="card_type" type="varchar(10)">
                <constraints nullable="false" />
            </column>
			<column name="cardholder_name" type="varchar(45)">
                <constraints nullable="false" />
            </column>
			<column name="cvs" type="int(3)">
				<constraints nullable="false"/>
            </column>
			<column name="expiry_date" type="date">
                <constraints nullable="false"/>
			</column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="credit_card" baseColumnNames="customer_id" 
									constraintName="credit_card_customer_id_fk" 
									referencedTableName="customer" referencedColumnNames="customer_id"/>
		
		<createTable tableName="manager"
                     remarks="A table to contain all managers">
            <column name="manager_id" type="varchar(10)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="first_name" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
            <column name="last_name" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
			<column name="username" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
			<column name="password" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
        </createTable>
	
	    <createTable tableName="restaurant"
                     remarks="A table to contain all restaurants">
            <column name="restaurant_id" type="varchar(10)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="name" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
            <column name="contact_number" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
            <column name="street" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
            <column name="postal_code" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
			<column name="cuisine" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
        </createTable>
									
		<createTable tableName="manager_allocation"
                     remarks="A table to contain all rights that a manager has">
            <column name="manager_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="restaurant_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="rights" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <addForeignKeyConstraint baseTableName="manager_allocation" baseColumnNames="manager_id"
									constraintName="manager_allocation_manager_id_fk"
									referencedTableName="manager" referencedColumnNames="manager_id"/>
									
		<addForeignKeyConstraint baseTableName="manager_allocation" baseColumnNames="restaurant_id"
									constraintName="manager_allocation_restaurant_id_fk"
									referencedTableName="restaurant" referencedColumnNames="restaurant_id"/>
		
		<createTable tableName="seating_table"
                     remarks="A table to contain all seating tables">
            <column name="qr_code" type="varchar(10)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="restaurant_id" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
            <column name="capacity" type="int(10)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <addForeignKeyConstraint baseTableName="seating_table" baseColumnNames="restaurant_id"
									constraintName="seating_table_restaurant_id_fk"
									referencedTableName="restaurant" referencedColumnNames="restaurant_id"/>
									
		<createTable tableName="food"
                     remarks="A table to contain all food items">
            <column name="food_id" type="varchar(10)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="name" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="varchar(500)">
                <constraints nullable="false"/>
            </column>
            <column name="category" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="menu"
                     remarks="A table to contain all menus">
            <column name="menu_id" type="varchar(10)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="restaurant_id" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
            <column name="date_of_creation" type="date">
                <constraints nullable="false"/>
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="menu" baseColumnNames="restaurant_id" 
									constraintName="menu_restaurant_id_fk" 
									referencedTableName="restaurant" referencedColumnNames="restaurant_id"/>
									
		<createTable tableName="food_price"
                     remarks="A table to contain all food prices that corresponds to their outle">
            <column name="menu_id" type="varchar(10)">
			    <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="food_id" type="varchar(10)">
				<constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="price" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="availability" type="tinyint(1)">
                <constraints nullable="false"/>
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="food_price" baseColumnNames="menu_id" 
									constraintName="food_price_menu_id_fk" 
									referencedTableName="menu" referencedColumnNames="menu_id"/>
									
		<addForeignKeyConstraint baseTableName="food_price" baseColumnNames="food_id" 
									constraintName="food_price_food_id_fk" 
									referencedTableName="food" referencedColumnNames="food_id"/>

        <createTable tableName="food_tag"
                     remarks="A table to contain all food tags">
            <column name="food_tag_id" type="varchar(10)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="description" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
        </createTable>
		
		<createTable tableName="food_tag_allocation"
                     remarks="A table to contain all food tag allocations">
            <column name="food_tag_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="food_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="food_tag_allocation" baseColumnNames="food_tag_id" 
									constraintName="food_tag_allocation_food_tag_id_fk" 
									referencedTableName="food_tag" referencedColumnNames="food_tag_id"/>
		
		<addForeignKeyConstraint baseTableName="food_tag_allocation" baseColumnNames="food_id" 
									constraintName="food_tag_allocation_food_id_fk" 
									referencedTableName="food" referencedColumnNames="food_id"/>
		
		<createTable tableName="customisation_option"
                     remarks="A table to contain all options for food customisations">
            <column name="customisation_option_id" type="varchar(10)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="description" type="varchar(45)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
		
		<createTable tableName="food_customisation"
                     remarks="A table to contain all food customisations">
            <column name="food_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
			<column name="customisation_option_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
			<column name="description" type="varchar(45)">
                <constraints nullable="false" />
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="food_customisation" baseColumnNames="food_id" 
									constraintName="food_customisation_food_id_fk" 
									referencedTableName="food" referencedColumnNames="food_id"/>
									
		<addForeignKeyConstraint baseTableName="food_customisation" baseColumnNames="customisation_option_id" 
									constraintName="food_customisation_customisation_option_id_fk" 
									referencedTableName="customisation_option" referencedColumnNames="customisation_option_id"/>
		
		<createTable tableName="customisation"
                     remarks="A table to contain all customisations">
            <column name="customisation_id" type="varchar(10)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
			<column name="food_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
			<column name="type" type="varchar(45)">
                <constraints nullable="false" />
            </column>
			<column name="description" type="varchar(45)">
                <constraints nullable="false" />
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="customisation" baseColumnNames="food_id" 
									constraintName="customisation_food_id_fk" 
									referencedTableName="food" referencedColumnNames="food_id"/>

		<createTable tableName="order_summary"
                     remarks="A table to contain all summary of multiple ordersper table">
			<column name="order_summary_id" type="varchar(10)">
				<constraints nullable="false" primaryKey="true"/>
            </column>
			<column name="customer_id" type="varchar(10)">
				<constraints nullable="false"/>
            </column>
			<column name="payment_status" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
            <column name="total_amount" type="double">
                <constraints nullable="false" />
            </column>
			<column name="summary_date" type="datetime">
                <constraints nullable="false"/>
			</column>
            <column name="mode_of_payment" type="varchar(45)">
				<constraints nullable="false"/>
            </column>
        </createTable>	

		<addForeignKeyConstraint baseTableName="order_summary" baseColumnNames="customer_id" 
									constraintName="order_summary_customer_id_fk" 
									referencedTableName="customer" referencedColumnNames="customer_id"/>		
		
		<createTable tableName="order"
                     remarks="A table to contain all orders">
			<column name="order_id" type="varchar(10)">
				<constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="restaurant_id" type="varchar(10)">
                <constraints nullable="false" />
            </column>
			<column name="qr_code" type="varchar(10)">
                <constraints nullable="false" />
            </column>
			<column name="order_summary_id" type="varchar(10)">
                <constraints nullable="false" />
            </column>
			<column name="subtotal" type="double">
                <constraints nullable="false" />
            </column>
			<column name="status" type="varchar(10)">
                <constraints nullable="false" />
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="order" baseColumnNames="restaurant_id" 
									constraintName="order_restaurant_id_fk" 
									referencedTableName="restaurant" referencedColumnNames="restaurant_id"/>
									
		<addForeignKeyConstraint baseTableName="order" baseColumnNames="qr_code"
									constraintName="order_seating_table_id_fk"
									referencedTableName="seating_table" referencedColumnNames="qr_code"/>

		<addForeignKeyConstraint baseTableName="order" baseColumnNames="order_summary_id"
									constraintName="order_order_summary_id_fk"
									referencedTableName="order_summary" referencedColumnNames="order_summary_id"/>

		<createTable tableName="customer_order"
                     remarks="A table to contain all customised orders by the customer">
			<column name="order_id" type="varchar(10)">
				<constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="food_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
			<column name="quantity" type="int(3)">
                <constraints nullable="false" />
            </column>
        </createTable>

		<addForeignKeyConstraint baseTableName="customer_order" baseColumnNames="order_id" 
									constraintName="customer_order_order_id_fk" 
									referencedTableName="order" referencedColumnNames="order_id"/>
									
		<addForeignKeyConstraint baseTableName="customer_order" baseColumnNames="food_id" 
									constraintName="customer_order_food_id_fk" 
									referencedTableName="food" referencedColumnNames="food_id"/>

		<createTable tableName="redemption"
                     remarks="A table to contain all customer's redemption history">
            <column name="redemption_id" type="varchar(10)">
				<constraints nullable="false" primaryKey="true"/>
            </column>
			<column name="restaurant_id" type="varchar(10)">
				<constraints nullable="false"/>
            </column>
			<column name="convert_rate" type="int(10)">
				<constraints nullable="false"/>
            </column>
			<column name="start_datetime" type="datetime">
                <constraints nullable="false"/>
			</column>
			<column name="end_datetime" type="datetime">
                <constraints nullable="false"/>
			</column>
			<column name="point_cap" type="int(10)">
                <constraints nullable="false"/>
            </column>
			<column name="description" type="varchar(200)">
                <constraints nullable="false"/>
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="redemption" baseColumnNames="restaurant_id" 
									constraintName="redemption_restaurant_id_fk" 
									referencedTableName="restaurant" referencedColumnNames="restaurant_id"/>
									
		<createTable tableName="redemption_history"
                     remarks="A table to contain all customer's redemption history">
            <column name="redemption_history_id" type="varchar(10)">
				<constraints nullable="false" primaryKey="true"/>
            </column>
			<column name="customer_id" type="varchar(10)">
				<constraints nullable="false"/>
            </column>
			<column name="redemption_id" type="varchar(10)">
				<constraints nullable="false"/>
            </column>
            <column name="order_summary_id" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
			<column name="points" type="int(10)">
                <constraints nullable="false"/>
            </column>
			<column name="redeem_date" type="datetime">
                <constraints nullable="false"/>
			</column>
			<column name="description" type="varchar(45)">
                <constraints nullable="false"/>
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="redemption_history" baseColumnNames="customer_id" 
									constraintName="redemption_history_customer_id_fk" 
									referencedTableName="customer" referencedColumnNames="customer_id"/>
		
		<addForeignKeyConstraint baseTableName="redemption_history" baseColumnNames="redemption_id" 
									constraintName="redemption_history_redemption_id_fk" 
									referencedTableName="redemption" referencedColumnNames="redemption_id"/>
		
		<addForeignKeyConstraint baseTableName="redemption_history" baseColumnNames="order_summary_id" 
									constraintName="redemption_history_order_summary_id_fk" 
									referencedTableName="order_summary" referencedColumnNames="order_summary_id"/>
									
    </changeSet>
</databaseChangeLog>
