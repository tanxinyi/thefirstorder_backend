<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="15" author="xinyi">
	    <createTable tableName="restaurant"
                     remarks="A table to contain all restaurants">
            <column name="restaurant_id" type="varchar(10)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="restaurant_name" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="restaurant_desc" type="varchar(225)">
                <constraints nullable="false"/>
            </column>
            <column name="restaurant_contact" type="int(10)">
                <constraints nullable="false"/>
            </column>
            <column name="restaurant_street" type="varchar(225)">
                <constraints nullable="false"/>
            </column>
            <column name="restaurant_postal_code" type="int(10)">
                <constraints nullable="false"/>
            </column>
			<column name="restaurant_cuisine" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
        </createTable>
		
		<createTable tableName="seating_table"
                     remarks="A table to contain all seating tables">
            <column name="table_id" type="varchar(10)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="restaurant_id" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
            <column name="capacity" type="int(3)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <addForeignKeyConstraint baseTableName="seating_table" baseColumnNames="restaurant_id" 
									constraintName="seating_table_restaurant_id_fk" 
									referencedTableName="restaurant" referencedColumnNames="restaurant_id"/>
									
		<createTable tableName="food"
                     remarks="A table to contain all food items">
            <column name="food_id" type="varchar(10)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="food_name" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="food_desc" type="varchar(225)">
                <constraints nullable="false"/>
            </column>
            <column name="food_category" type="varchar(20)">
                <constraints nullable="false"/>
            </column>
        </createTable>
		
		<createTable tableName="menu"
                     remarks="A table to contain all menus">
            <column name="menu_id" type="varchar(10)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="restaurant_id" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
            <column name="date_of_creation" type="date">
                <constraints nullable="false"/>
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="menu" baseColumnNames="restaurant_id" 
									constraintName="menu_restaurant_id_fk" 
									referencedTableName="restaurant" referencedColumnNames="restaurant_id"/>
									
		<createTable tableName="menu_price"
                     remarks="A table to contain all menu prices">
            <column name="menu_id" type="varchar(10)">
			    <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="food_id" type="varchar(10)">
				<constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="price" type="double(10)">
                <constraints nullable="false"/>
            </column>
            <column name="out_of_stock" type="boolean">
                <constraints nullable="false"/>
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="menu_price" baseColumnNames="menu_id" 
									constraintName="menu_prices_menu_id_fk" 
									referencedTableName="menu" referencedColumnNames="menu_id"/>
									
		<addForeignKeyConstraint baseTableName="menu_price" baseColumnNames="food_id" 
									constraintName="menu_prices_food_id_fk" 
									referencedTableName="food" referencedColumnNames="food_id"/>

        <createTable tableName="food_tag"
                     remarks="A table to contain all food tags">
			<column name="tag_id" type="varchar(10)">
                <constraints nullable="false" unique="true" primaryKey="true"/>
            </column>
            <column name="food_id" type="varchar(10)">
                <constraints nullable="false" />
            </column>
            <column name="tag_desc" type="varchar(100)">
                <constraints nullable="false" />
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="food_tag" baseColumnNames="food_id" 
									constraintName="food_tag_food_id_fk" 
									referencedTableName="food" referencedColumnNames="food_id"/>
									
		<createTable tableName="food_customisation"
                     remarks="A table to contain all food customisations">
			<column name="customisation_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="food_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
			<column name="customisation_name" type="varchar(100)">
                <constraints nullable="false" />
            </column>
            <column name="customisation_type" type="varchar(100)">
                <constraints nullable="false" />
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="food_customisation" baseColumnNames="food_id" 
									constraintName="food_customisation_food_id_fk" 
									referencedTableName="food" referencedColumnNames="food_id"/>
									
		<createTable tableName="customisation_option"
                     remarks="A table to contain all options for food customisations">
            <column name="customisation_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="option_desc" type="varchar(100)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="customisation_option" baseColumnNames="customisation_id" 
									constraintName="customisation_option_customisation_id_fk" 
									referencedTableName="food_customisation" referencedColumnNames="customisation_id"/>								
		
		<createTable tableName="order"
                     remarks="A table to contain all orders">
			<column name="order_id" type="varchar(10)">
				<constraints nullable="false" primaryKey="true"/>
            </column>
			<column name="food_counter" type="int(10)" autoIncrement="${autoIncrement}" startWith="1">
				<constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="food_id" type="varchar(10)">
                <constraints nullable="false" />
            </column>
            <column name="quantity" type="int(3)">
                <constraints nullable="false" />
            </column>
			<column name="amount" type="double(10)">
                <constraints nullable="false" />
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="order" baseColumnNames="food_id" 
									constraintName="order_food_id_fk" 
									referencedTableName="food" referencedColumnNames="food_id"/>
									
		<createTable tableName="customer_order"
                     remarks="A table to contain all customised orders by the customer">
			<column name="order_id" type="varchar(10)">
				<constraints nullable="false" primaryKey="true"/>
            </column>
			<column name="customer_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="food_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="option_desc" type="varchar(100)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>

		<addForeignKeyConstraint baseTableName="customer_order" baseColumnNames="order_id" 
									constraintName="customer_order_order_id_fk" 
									referencedTableName="order" referencedColumnNames="order_id"/>
									
		<addForeignKeyConstraint baseTableName="customer_order" baseColumnNames="food_id" 
									constraintName="customer_order_food_id_fk" 
									referencedTableName="food" referencedColumnNames="food_id"/>
									
		<addForeignKeyConstraint baseTableName="customer_order" baseColumnNames="option_desc" 
									constraintName="customer_order_option_desc_fk" 
									referencedTableName="customisation_option" referencedColumnNames="option_desc"/>
									
		<addForeignKeyConstraint baseTableName="customer_order" baseColumnNames="customer_id" 
									constraintName="customer_order_customer_id_fk" 
									referencedTableName="customer" referencedColumnNames="customer_id"/>
									
		<createTable tableName="order_summary"
                     remarks="A table to contain all order summaries of a table">
            <column name="order_id" type="varchar(10)">
				<constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="restaurant_id" type="varchar(10)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
			<column name="table_id" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
			<column name="customer_id" type="varchar(10)">
				<constraints nullable="false"/>
            </column>
			<column name="order_status" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
			<column name="total_amount" type="double(10)">
                <constraints nullable="false"/>
            </column>
            <column name="time" type="timestamp">
                <constraints nullable="false"/>
            </column>
			<column name="mode_of_payment" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
        </createTable>
		
		<addForeignKeyConstraint baseTableName="order_summary" baseColumnNames="order_id" 
									constraintName="order_summary_order_id_fk" 
									referencedTableName="order" referencedColumnNames="order_id"/>
									
		<addForeignKeyConstraint baseTableName="order_summary" baseColumnNames="restaurant_id" 
									constraintName="order_summary_restaurant_id_fk" 
									referencedTableName="restaurant" referencedColumnNames="restaurant_id"/>
									
		<addForeignKeyConstraint baseTableName="order_summary" baseColumnNames="table_id" 
									constraintName="order_summary_table_id_fk" 
									referencedTableName="table" referencedColumnNames="table_id"/>
									
		<addForeignKeyConstraint baseTableName="order_summary" baseColumnNames="customer_id" 
									constraintName="order_summary_customer_id_fk" 
									referencedTableName="customer" referencedColumnNames="customer_id"/>
									

    </changeSet>
</databaseChangeLog>
